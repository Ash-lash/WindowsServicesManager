<Window
    x:Class="WindowsServicesManager.MainWindow"
    x:Name="RootWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:WindowsServicesManager"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Windows Services Manager">

    <StackPanel>
        <StackPanel.Resources>
            <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        </StackPanel.Resources>

        <!-- Column Chooser -->
        <Expander Header="Column Chooser" Margin="10">
            <StackPanel Orientation="Horizontal">
                <CheckBox Content="Service Name" IsChecked="{Binding ShowServiceName, Mode=TwoWay, ElementName=RootWindow}" Margin="5"/>
                <CheckBox Content="Description" IsChecked="{Binding ShowDescription, Mode=TwoWay, ElementName=RootWindow}" Margin="5"/>
                <CheckBox Content="Status" IsChecked="{Binding ShowStatus, Mode=TwoWay, ElementName=RootWindow}" Margin="5"/>
                <CheckBox Content="Startup Type" IsChecked="{Binding ShowStartType, Mode=TwoWay, ElementName=RootWindow}" Margin="5"/>
                <CheckBox Content="Log On As" IsChecked="{Binding ShowLogOnAs, Mode=TwoWay, ElementName=RootWindow}" Margin="5"/>
                <CheckBox Content="Path Name" IsChecked="{Binding ShowPathName, Mode=TwoWay, ElementName=RootWindow}" Margin="5"/>
                <CheckBox Content="Service Type" IsChecked="{Binding ShowServiceType, Mode=TwoWay, ElementName=RootWindow}" Margin="5"/>
                <CheckBox Content="Can Pause/Continue" IsChecked="{Binding ShowCanPauseAndContinue, Mode=TwoWay, ElementName=RootWindow}" Margin="5"/>
                <CheckBox Content="Can Stop" IsChecked="{Binding ShowCanStop, Mode=TwoWay, ElementName=RootWindow}" Margin="5"/>
                <CheckBox Content="Error Control" IsChecked="{Binding ShowErrorControl, Mode=TwoWay, ElementName=RootWindow}" Margin="5"/>
                <CheckBox Content="WMI Description" IsChecked="{Binding ShowDescriptionWmi, Mode=TwoWay, ElementName=RootWindow}" Margin="5"/>
            </StackPanel>
        </Expander>

        <!-- Action Buttons -->
        <CommandBar Margin="10">
            <AppBarButton Icon="Play" Label="Start" Click="StartButton_Click" ToolTipService.ToolTip="Start Service" IsEnabled="{Binding IsServiceSelected, ElementName=RootWindow}"/>
            <AppBarButton Icon="Stop" Label="Stop" Click="StopButton_Click" ToolTipService.ToolTip="Stop Service" IsEnabled="{Binding IsServiceSelected, ElementName=RootWindow}"/>
            <AppBarButton Icon="Pause" Label="Pause" Click="PauseButton_Click" ToolTipService.ToolTip="Pause Service" IsEnabled="{Binding IsServiceSelected, ElementName=RootWindow}"/>
            <AppBarSeparator/>
            <AppBarButton Icon="Refresh" Label="Refresh" Click="RefreshButton_Click"/>
        </CommandBar>

        <!-- Top panel with search, sort, and sort order -->
        <StackPanel Orientation="Horizontal" Margin="10">
            <TextBox x:Name="SearchBox" Width="300" PlaceholderText="Search by Service Name..." Margin="0,0,10,0"/>
            <TextBlock Text="Sort by:" VerticalAlignment="Center" Margin="10,0,0,0"/>
            <ComboBox x:Name="SortComboBox" Width="150" SelectionChanged="SortComboBox_SelectionChanged" Margin="5,0,0,0">
                <ComboBoxItem Content="Service Name" Tag="ServiceName" IsSelected="True"/>
                <ComboBoxItem Content="Status" Tag="Status"/>
                <ComboBoxItem Content="Startup Type" Tag="StartType"/>
            </ComboBox>
            <ToggleButton x:Name="SortOrderToggle" Width="40" Height="32" Margin="5,0,0,0"
                          Checked="SortOrderToggle_Checked" Unchecked="SortOrderToggle_Checked" 
                          ToolTipService.ToolTip="Toggle Ascending/Descending">
                <SymbolIcon Symbol="Sort" x:Name="SortOrderIcon"/>
            </ToggleButton>
        </StackPanel>

        <!-- DataGrid for services -->
        <controls:DataGrid x:Name="ServicesDataGrid"
                           ItemsSource="{x:Bind services, Mode=OneWay}"
                           AutoGenerateColumns="False"
                           Height="600"
                           Margin="10"
                           SelectionMode="Single"
                           SelectedItem="{Binding SelectedService, Mode=TwoWay, ElementName=RootWindow}">
            <controls:DataGrid.Columns>
                <controls:DataGridTextColumn x:Name="ServiceNameColumn" Header="Service Name" Binding="{Binding ServiceName}" Width="200"/>
                <controls:DataGridTextColumn x:Name="DescriptionColumn" Header="Description" Binding="{Binding DisplayName}" Width="250"/>
                <controls:DataGridTextColumn x:Name="StatusColumn" Header="Status" Binding="{Binding Status}" Width="100"/>
                <controls:DataGridTextColumn x:Name="StartTypeColumn" Header="Startup Type" Binding="{Binding StartType}" Width="120"/>
                <controls:DataGridTextColumn x:Name="LogOnAsColumn" Header="Log On As" Binding="{Binding LogOnAs}" Width="120"/>
                <controls:DataGridTextColumn x:Name="PathNameColumn" Header="Path Name" Binding="{Binding PathName}" Width="220"/>
                <controls:DataGridTextColumn x:Name="ServiceTypeColumn" Header="Service Type" Binding="{Binding ServiceType}" Width="120"/>
                <controls:DataGridTextColumn x:Name="CanPauseAndContinueColumn" Header="Can Pause/Continue" Binding="{Binding CanPauseAndContinue}" Width="120"/>
                <controls:DataGridTextColumn x:Name="CanStopColumn" Header="Can Stop" Binding="{Binding CanStop}" Width="120"/>
                <controls:DataGridTextColumn x:Name="ErrorControlColumn" Header="Error Control" Binding="{Binding ErrorControl}" Width="120"/>
                <controls:DataGridTextColumn x:Name="DescriptionWmiColumn" Header="WMI Description" Binding="{Binding Description}" Width="300"/>
            </controls:DataGrid.Columns>
        </controls:DataGrid>
    </StackPanel>
</Window>